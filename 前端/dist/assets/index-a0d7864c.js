import{U as we,f as J,j as le,g as Y,a as u,R as z,n as T,t as U,k as j,W as x,I as D,i as G,h as xe,v as ie,N as q,al as re,am as Ee,an as Pe,ao as Be,ap as Le,aq as Te,p as Me,e as H,l as Ae,s as F,ar as Re,as as _e,x as $e,J as W,z as Fe,F as ze,G as De,at as ee,au as Ne,V as te,m as Oe,d as We,av as je}from"./index-8c98e848.js";import{r as qe,u as He}from"./index-1c5e6985.js";let Ke=0;function Ue(){const e=we(),{name:n="unknown"}=(e==null?void 0:e.type)||{};return`${n}-${++Ke}`}const[Je,R]=J("cell"),oe={tag:z("div"),icon:String,size:String,title:T,value:T,label:T,center:Boolean,isLink:Boolean,border:U,required:Boolean,iconPrefix:String,valueClass:j,labelClass:j,titleClass:j,titleStyle:null,arrowDirection:String,clickable:{type:Boolean,default:null}},Ye=le({},oe,qe);var Ge=Y({name:Je,props:Ye,setup(e,{slots:n}){const s=He(),d=()=>{if(n.label||x(e.label))return u("div",{class:[R("label"),e.labelClass]},[n.label?n.label():e.label])},r=()=>{var c;if(n.title||x(e.title)){const b=(c=n.title)==null?void 0:c.call(n);return Array.isArray(b)&&b.length===0?void 0:u("div",{class:[R("title"),e.titleClass],style:e.titleStyle},[b||u("span",null,[e.title]),d()])}},f=()=>{const c=n.value||n.default;if(c||x(e.value))return u("div",{class:[R("value"),e.valueClass]},[c?c():u("span",null,[e.value])])},M=()=>{if(n.icon)return n.icon();if(e.icon)return u(D,{name:e.icon,class:R("left-icon"),classPrefix:e.iconPrefix},null)},P=()=>{if(n["right-icon"])return n["right-icon"]();if(e.isLink){const c=e.arrowDirection&&e.arrowDirection!=="right"?`arrow-${e.arrowDirection}`:"arrow";return u(D,{name:c,class:R("right-icon")},null)}};return()=>{var c;const{tag:b,size:m,center:_,border:B,isLink:A,required:k}=e,E=(c=e.clickable)!=null?c:A,a={center:_,required:k,clickable:E,borderless:!B};return m&&(a[m]=!!m),u(b,{class:R(a),role:E?"button":void 0,tabindex:E?0:void 0,onClick:s},{default:()=>{var o;return[M(),r(),f(),P(),(o=n.extra)==null?void 0:o.call(n)]}})}}});const Qe=G(Ge),[Xe,Ze]=J("form"),pe={colon:Boolean,disabled:Boolean,readonly:Boolean,showError:Boolean,labelWidth:T,labelAlign:String,inputAlign:String,scrollToError:Boolean,validateFirst:Boolean,submitOnEnter:U,showErrorMessage:U,errorMessageAlign:String,validateTrigger:{type:[String,Array],default:"onBlur"}};var et=Y({name:Xe,props:pe,emits:["submit","failed"],setup(e,{emit:n,slots:s}){const{children:d,linkChildren:r}=xe(re),f=a=>a?d.filter(o=>a.includes(o.name)):d,M=a=>new Promise((o,v)=>{const S=[];f(a).reduce(($,N)=>$.then(()=>{if(!S.length)return N.validate().then(L=>{L&&S.push(L)})}),Promise.resolve()).then(()=>{S.length?v(S):o()})}),P=a=>new Promise((o,v)=>{const S=f(a);Promise.all(S.map(C=>C.validate())).then(C=>{C=C.filter(Boolean),C.length?v(C):o()})}),c=a=>{const o=d.find(v=>v.name===a);return o?new Promise((v,S)=>{o.validate().then(C=>{C?S(C):v()})}):Promise.reject()},b=a=>typeof a=="string"?c(a):e.validateFirst?M(a):P(a),m=a=>{typeof a=="string"&&(a=[a]),f(a).forEach(v=>{v.resetValidation()})},_=()=>d.reduce((a,o)=>(a[o.name]=o.getValidationStatus(),a),{}),B=(a,o)=>{d.some(v=>v.name===a?(v.$el.scrollIntoView(o),!0):!1)},A=()=>d.reduce((a,o)=>(o.name!==void 0&&(a[o.name]=o.formValue.value),a),{}),k=()=>{const a=A();b().then(()=>n("submit",a)).catch(o=>{n("failed",{values:a,errors:o}),e.scrollToError&&o[0].name&&B(o[0].name)})},E=a=>{q(a),k()};return r({props:e}),ie({submit:k,validate:b,getValues:A,scrollToField:B,resetValidation:m,getValidationStatus:_}),()=>{var a;return u("form",{class:Ze(),onSubmit:E},[(a=s.default)==null?void 0:a.call(s)])}}});const ft=G(et);function se(e){return Array.isArray(e)?!e.length:e===0?!1:!e}function tt(e,n){if(se(e)){if(n.required)return!1;if(n.validateEmpty===!1)return!0}return!(n.pattern&&!n.pattern.test(String(e)))}function nt(e,n){return new Promise(s=>{const d=n.validator(e,n);if(Be(d)){d.then(s);return}s(d)})}function ne(e,n){const{message:s}=n;return Le(s)?s(e,n):s||""}function at({target:e}){e.composing=!0}function ae({target:e}){e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}function lt(e,n){const s=Ee();e.style.height="auto";let d=e.scrollHeight;if(Te(n)){const{maxHeight:r,minHeight:f}=n;r!==void 0&&(d=Math.min(d,r)),f!==void 0&&(d=Math.max(d,f))}d&&(e.style.height=`${d}px`,Pe(s))}function it(e){return e==="number"?{type:"text",inputmode:"decimal"}:e==="digit"?{type:"tel",inputmode:"numeric"}:{type:e}}function w(e){return[...e].length}function K(e,n){return[...e].slice(0,n).join("")}const[rt,V]=J("field"),ot={id:String,name:String,leftIcon:String,rightIcon:String,autofocus:Boolean,clearable:Boolean,maxlength:T,formatter:Function,clearIcon:z("clear"),modelValue:De(""),inputAlign:String,placeholder:String,autocomplete:String,autocapitalize:String,autocorrect:String,errorMessage:String,enterkeyhint:String,spellcheck:{type:Boolean,default:null},clearTrigger:z("focus"),formatTrigger:z("onChange"),error:{type:Boolean,default:null},disabled:{type:Boolean,default:null},readonly:{type:Boolean,default:null}},st=le({},oe,ot,{rows:T,type:z("text"),rules:Array,autosize:[Boolean,Object],labelWidth:T,labelClass:j,labelAlign:String,showWordLimit:Boolean,errorMessageAlign:String,colon:{type:Boolean,default:null}});var ct=Y({name:rt,props:st,emits:["blur","focus","clear","keypress","clickInput","endValidate","startValidate","clickLeftIcon","clickRightIcon","update:modelValue"],setup(e,{emit:n,slots:s}){const d=Ue(),r=Me({status:"unvalidated",focused:!1,validateMessage:""}),f=H(),M=H(),P=H(),{parent:c}=Ae(re),b=()=>{var t;return String((t=e.modelValue)!=null?t:"")},m=t=>{if(x(e[t]))return e[t];if(c&&x(c.props[t]))return c.props[t]},_=F(()=>{const t=m("readonly");if(e.clearable&&!t){const i=b()!=="",l=e.clearTrigger==="always"||e.clearTrigger==="focus"&&r.focused;return i&&l}return!1}),B=F(()=>P.value&&s.input?P.value():e.modelValue),A=t=>t.reduce((i,l)=>i.then(()=>{if(r.status==="failed")return;let{value:g}=B;if(l.formatter&&(g=l.formatter(g,l)),!tt(g,l)){r.status="failed",r.validateMessage=ne(g,l);return}if(l.validator)return se(g)&&l.validateEmpty===!1?void 0:nt(g,l).then(h=>{h&&typeof h=="string"?(r.status="failed",r.validateMessage=h):h===!1&&(r.status="failed",r.validateMessage=ne(g,l))})}),Promise.resolve()),k=()=>{r.status="unvalidated",r.validateMessage=""},E=()=>n("endValidate",{status:r.status,message:r.validateMessage}),a=(t=e.rules)=>new Promise(i=>{k(),t?(n("startValidate"),A(t).then(()=>{r.status==="failed"?(i({name:e.name,message:r.validateMessage}),E()):(r.status="passed",i(),E())})):i()}),o=t=>{if(c&&e.rules){const{validateTrigger:i}=c.props,l=ee(i).includes(t),g=e.rules.filter(h=>h.trigger?ee(h.trigger).includes(t):l);g.length&&a(g)}},v=t=>{var i;const{maxlength:l}=e;if(x(l)&&w(t)>+l){const g=b();if(g&&w(g)===+l)return g;const h=(i=f.value)==null?void 0:i.selectionEnd;if(r.focused&&h){const y=[...t],I=y.length-+l;return y.splice(h-I,I),y.join("")}return K(t,+l)}return t},S=(t,i="onChange")=>{const l=t;t=v(t);const g=w(l)-w(t);if(e.type==="number"||e.type==="digit"){const y=e.type==="number";t=Ne(t,y,y)}let h=0;if(e.formatter&&i===e.formatTrigger){const{formatter:y,maxlength:I}=e;if(t=y(t),x(I)&&w(t)>+I&&(t=K(t,+I)),f.value&&r.focused){const{selectionEnd:O}=f.value,p=K(l,O);h=w(y(p))-w(p)}}if(f.value&&f.value.value!==t)if(r.focused){let{selectionStart:y,selectionEnd:I}=f.value;if(f.value.value=t,x(y)&&x(I)){const O=w(t);g?(y-=g,I-=g):h&&(y+=h,I+=h),f.value.setSelectionRange(Math.min(y,O),Math.min(I,O))}}else f.value.value=t;t!==e.modelValue&&n("update:modelValue",t)},C=t=>{t.target.composing||S(t.target.value)},$=()=>{var t;return(t=f.value)==null?void 0:t.blur()},N=()=>{var t;return(t=f.value)==null?void 0:t.focus()},L=()=>{const t=f.value;e.type==="textarea"&&e.autosize&&t&&lt(t,e.autosize)},ce=t=>{r.focused=!0,n("focus",t),W(L),m("readonly")&&$()},ue=t=>{r.focused=!1,S(b(),"onBlur"),n("blur",t),!m("readonly")&&(o("onBlur"),W(L),je())},Q=t=>n("clickInput",t),de=t=>n("clickLeftIcon",t),fe=t=>n("clickRightIcon",t),ge=t=>{q(t),n("update:modelValue",""),n("clear",t)},X=F(()=>{if(typeof e.error=="boolean")return e.error;if(c&&c.props.showError&&r.status==="failed")return!0}),me=F(()=>{const t=m("labelWidth"),i=m("labelAlign");if(t&&i!=="top")return{width:te(t)}}),he=t=>{t.keyCode===13&&(!(c&&c.props.submitOnEnter)&&e.type!=="textarea"&&q(t),e.type==="search"&&$()),n("keypress",t)},Z=()=>e.id||`${d}-input`,be=()=>r.status,ve=()=>{const t=V("control",[m("inputAlign"),{error:X.value,custom:!!s.input,"min-height":e.type==="textarea"&&!e.autosize}]);if(s.input)return u("div",{class:t,onClick:Q},[s.input()]);const i={id:Z(),ref:f,name:e.name,rows:e.rows!==void 0?+e.rows:void 0,class:t,disabled:m("disabled"),readonly:m("readonly"),autofocus:e.autofocus,placeholder:e.placeholder,autocomplete:e.autocomplete,autocapitalize:e.autocapitalize,autocorrect:e.autocorrect,enterkeyhint:e.enterkeyhint,spellcheck:e.spellcheck,"aria-labelledby":e.label?`${d}-label`:void 0,onBlur:ue,onFocus:ce,onInput:C,onClick:Q,onChange:ae,onKeypress:he,onCompositionend:ae,onCompositionstart:at};return e.type==="textarea"?u("textarea",i,null):u("input",Oe(it(e.type),i),null)},ye=()=>{const t=s["left-icon"];if(e.leftIcon||t)return u("div",{class:V("left-icon"),onClick:de},[t?t():u(D,{name:e.leftIcon,classPrefix:e.iconPrefix},null)])},Se=()=>{const t=s["right-icon"];if(e.rightIcon||t)return u("div",{class:V("right-icon"),onClick:fe},[t?t():u(D,{name:e.rightIcon,classPrefix:e.iconPrefix},null)])},Ce=()=>{if(e.showWordLimit&&e.maxlength){const t=w(b());return u("div",{class:V("word-limit")},[u("span",{class:V("word-num")},[t]),We("/"),e.maxlength])}},Ve=()=>{if(c&&c.props.showErrorMessage===!1)return;const t=e.errorMessage||r.validateMessage;if(t){const i=s["error-message"],l=m("errorMessageAlign");return u("div",{class:V("error-message",l)},[i?i({message:t}):t])}},Ie=()=>{const t=m("labelWidth"),i=m("labelAlign"),l=m("colon")?":":"";if(s.label)return[s.label(),l];if(e.label)return u("label",{id:`${d}-label`,for:s.input?void 0:Z(),onClick:g=>{q(g),N()},style:i==="top"&&t?{width:te(t)}:void 0},[e.label+l])},ke=()=>[u("div",{class:V("body")},[ve(),_.value&&u(D,{ref:M,name:e.clearIcon,class:V("clear")},null),Se(),s.button&&u("div",{class:V("button")},[s.button()])]),Ce(),Ve()];return ie({blur:$,focus:N,validate:a,formValue:B,resetValidation:k,getValidationStatus:be}),Re(_e,{customValue:P,resetValidation:k,validateWithTrigger:o}),$e(()=>e.modelValue,()=>{S(b()),k(),o("onChange"),W(L)}),Fe(()=>{S(b(),e.formatTrigger),W(L)}),ze("touchstart",ge,{target:F(()=>{var t;return(t=M.value)==null?void 0:t.$el})}),()=>{const t=m("disabled"),i=m("labelAlign"),l=ye(),g=()=>{const h=Ie();return i==="top"?[l,h].filter(Boolean):h||[]};return u(Qe,{size:e.size,class:V({error:X.value,disabled:t,[`label-${i}`]:i}),center:e.center,border:e.border,isLink:e.isLink,clickable:e.clickable,titleStyle:me.value,valueClass:V("value"),titleClass:[V("label",[i,{required:e.required}]),e.labelClass],arrowDirection:e.arrowDirection},{icon:l&&i!=="top"?()=>l:null,title:g,value:ke,extra:s.extra})}}});const gt=G(ct);export{Qe as C,ft as F,gt as a,Ue as u};
